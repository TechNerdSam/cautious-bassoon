<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©fi Z√©ro D√©chet de la Semaine</title>
    <!-- Chargement de Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Space Grotesk pour les titres, Inter pour le corps --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1A202C 0%, #2D3748 100%); /* D√©grad√© sombre futuriste */
            color: #E2E8F0; /* Texte clair */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1.5rem;
            overflow: hidden; /* Pour le fond √©toil√© si ajout√© */
        }
        h1, .challenge-text {
            font-family: 'Space Grotesk', sans-serif;
        }
        /* Effet de glow pour le d√©fi */
        .challenge-card {
            background: #2D3748; /* Couleur de fond de la carte */
            border: 1px solid rgba(71, 85, 105, 0.5); /* Bordure subtile */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 40px rgba(47, 212, 187, 0.2); /* Ombre et glow */
            transition: transform 0.3s ease-in-out;
        }
        .challenge-card:hover {
            transform: translateY(-5px);
        }
        .challenge-icon {
            filter: drop-shadow(0 0 8px #2FD4BB); /* Glow pour l'ic√¥ne */
        }
        /* Style pour le texte "loading" */
        #loading-message {
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body>

    <div class="relative w-full max-w-3xl mx-auto rounded-3xl p-8 md:p-12 text-center overflow-hidden">
        
        <!-- En-t√™te --><div class="mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-emerald-500 mb-4 tracking-tight">
                Le D√©fi Z√©ro D√©chet
            </h1>
            <p class="text-xl text-gray-400 max-w-prose mx-auto">
                <span class="challenge-icon text-4xl inline-block mr-2">‚ôªÔ∏è</span> Chaque lundi, d√©couvrez un nouveau challenge pour un futur plus durable.
            </p>
        </div>

        <!-- Conteneur pour le d√©fi actuel --><div class="challenge-card rounded-2xl p-8 md:p-10 min-h-[220px] flex flex-col justify-center items-center">
            <!-- Ic√¥ne de chargement stylis√©e --><svg id="loading-spinner" class="animate-spin h-10 w-10 text-teal-400 mb-4 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p id="loading-message" class="text-gray-500 italic text-lg hidden">G√©n√©rant le d√©fi stellaire...</p>
            
            <!-- Le d√©fi et la date seront inject√©s ici par JS --><blockquote id="challenge-text" class="challenge-text text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-teal-300 to-emerald-400 hidden leading-snug mb-4"></blockquote>
            <p id="challenge-date" class="text-md md:text-lg text-gray-400 hidden uppercase tracking-wide"></p>
        </div>

        <!-- Pied de page --><footer class="mt-12 text-center">
            <p class="text-sm text-gray-500">
                Propuls√© par <a href="https://github.com/features/actions" target="_blank" class="text-teal-400 hover:text-teal-300 transition-colors duration-200">GitHub Actions</a> & <a href="https://ai.google.dev/" target="_blank" class="text-teal-400 hover:text-teal-300 transition-colors duration-200">Google AI</a>.
            </p>
        </footer>
    </div>

    <script>
        // *** ATTENTION ***
        // Dans cette version "tout-en-un", le d√©fi est cod√© en dur ci-dessous.
        // Cela SIGNIFIE que l'action GitHub ne mettra PAS √† jour ce site web.
        // Pour que l'action fonctionne (avec mise √† jour automatique), vous DEVEZ utiliser
        // la version pr√©c√©dente qui utilise `fetch('./challenge.json')` et les fichiers s√©par√©s.

        const challengeData = {
          "challenge": "Bienvenue dans notre voyage vers le z√©ro d√©chet ! Le premier d√©fi sera g√©n√©r√© d√®s lundi.",
          "date": "En attente de la synchronisation hebdomadaire"
        };

        // Fonction pour charger le d√©fi
        async function loadChallenge() {
            const loadingMessage = document.getElementById('loading-message');
            const loadingSpinner = document.getElementById('loading-spinner');
            const challengeText = document.getElementById('challenge-text');
            const challengeDate = document.getElementById('challenge-date');

            // Afficher le spinner et le message de chargement
            loadingSpinner.classList.remove('hidden');
            loadingMessage.classList.remove('hidden');
            challengeText.classList.add('hidden');
            challengeDate.classList.add('hidden');

            try {
                // Simule un court d√©lai de chargement pour l'effet visuel
                await new Promise(resolve => setTimeout(resolve, 1500)); // 1.5 secondes de chargement

                // Si vous aviez un challenge.json s√©par√©, ce serait:
                // const cacheBuster = new Date().getTime();
                // const response = await fetch(`./challenge.json?v=${cacheBuster}`);
                // if (!response.ok) { throw new Error('Impossible de charger le fichier du d√©fi.'); }
                // const data = await response.json();
                
                const data = challengeData; // Utilise les donn√©es locales dans cette version unique
                
                // Mettre √† jour le DOM avec les donn√©es
                challengeText.textContent = data.challenge;
                challengeDate.textContent = data.date;

            } catch (error) {
                console.error('Erreur lors du chargement du d√©fi:', error);
                challengeText.textContent = "Oops! Le nexus du d√©fi est hors ligne. R√©essayez plus tard. üòî";
                challengeDate.textContent = "";
                challengeText.classList.remove('bg-clip-text', 'bg-gradient-to-r', 'from-teal-300', 'to-emerald-400'); // Enl√®ve le d√©grad√© pour le message d'erreur
                challengeText.classList.add('text-red-400'); // Met le message d'erreur en rouge
            } finally {
                // Cacher le spinner et le message de chargement
                loadingSpinner.classList.add('hidden');
                loadingMessage.classList.add('hidden');
                // Afficher le d√©fi ou le message d'erreur
                challengeText.classList.remove('hidden');
                challengeDate.classList.remove('hidden');
            }
        }

        // Charger le d√©fi au chargement de la page
        document.addEventListener('DOMContentLoaded', loadChallenge);
    </script>

    <!-- 
    ====================================================================
    INFORMATIONS DU PROJET (Normalement dans des fichiers s√©par√©s)
    ====================================================================

    Pour que le projet fonctionne comme pr√©vu (avec mise √† jour automatique
    du d√©fi par GitHub Actions), vous DEVEZ revenir √† la structure avec
    des fichiers s√©par√©s et NE PAS utiliser cette version "tout-en-un".

    Voici les fichiers que vous devriez avoir pour l'automatisation:


    --------------------------------------------------------------------
    Fichier 1 : challenge.json (plac√© √† la racine)
    --------------------------------------------------------------------

    {
      "challenge": "Bienvenue ! Le premier d√©fi sera g√©n√©r√© lundi prochain.",
      "date": "En attente de la premi√®re mise √† jour"
    }


    --------------------------------------------------------------------
    Fichier 2 : .github/workflows/update_challenge.yml (chemin exact)
    --------------------------------------------------------------------

    name: ‚ôªÔ∏è Mettre √† jour le D√©fi Z√©ro D√©chet

    on:
      # Ex√©cute l'action tous les lundis √† 08:00 UTC
      schedule:
        - cron: '0 8 * * 1'
      
      # Permet de d√©clencher l'action manuellement depuis l'onglet Actions de GitHub
      workflow_dispatch:

    jobs:
      update-challenge:
        runs-on: ubuntu-latest
        
        # D√©finit les permissions pour que l'action puisse √©crire dans le d√©p√¥t
        permissions:
          contents: write

        steps:
          - name: 1. R√©cup√©ration du code
            uses: actions/checkout@v4

          - name: 2. Installation de jq (parseur JSON)
            run: sudo apt-get install -y jq

          - name: 3. Appel de l'IA pour le nouveau d√©fi
            id: get_challenge
            run: |
              # Le prompt envoy√© √† l'IA
              PROMPT_TEXT="Propose un d√©fi 'z√©ro d√©chet' simple pour la semaine (ex: 'Cette semaine, n'utilisez pas de sacs en plastique'). Le d√©fi doit √™tre une seule phrase concise et actionnable, en fran√ßais, avec une touche futuriste et inspirante."
              
              # Construit la requ√™te JSON pour l'API Gemini
              JSON_PAYLOAD=$(jq -n --arg prompt "$PROMPT_TEXT" \
                '{contents: [{parts: [{text: $prompt}]}]}')
              
              # Appel cURL √† l'API Gemini
              # Note : ${{ secrets.GEMINI_API_KEY }} est un secret que vous devez cr√©er dans GitHub
              API_RESPONSE=$(curl -s -X POST "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${{ secrets.GEMINI_API_KEY }}" \
                -H "Content-Type: application/json" \
                -d "$JSON_PAYLOAD")

              # Extraction du texte de la r√©ponse
              CHALLENGE_TEXT=$(echo "$API_RESPONSE" | jq -r '.candidates[0].content.parts[0].text // empty')

              # V√©rification si l'extraction a √©chou√©
              if [ -z "$CHALLENGE_TEXT" ] || [ "$CHALLENGE_TEXT" == "null" ]; then
                echo "::error::√âchec de la r√©cup√©ration du d√©fi depuis l'API."
                echo "R√©ponse de l'API: $API_RESPONSE"
                exit 1
              fi

              # Nettoyage du texte (enl√®ve les guillemets au d√©but/fin)
              CHALLENGE_TEXT=$(echo "$CHALLENGE_TEXT" | sed 's/^["]*//' | sed 's/["]*$//')

              # Stocke le d√©fi dans une variable de sortie
              echo "challenge_text=$CHALLENGE_TEXT" >> $GITHUB_OUTPUT

          - name: 4. Mise √† jour du fichier challenge.json
            run: |
              # R√©cup√®re le d√©fi de l'√©tape pr√©c√©dente
              CHALLENGE_TEXT="${{ steps.get_challenge.outputs.challenge_text }}"
              
              # G√©n√®re la date en fran√ßais (n√©cessite l'installation du pack de langue)
              sudo locale-gen fr_FR.UTF-8
              CHALLENGE_DATE=$(LC_TIME=fr_FR.UTF-8 date +'%e %B %Y' | sed 's/  / /g' | sed 's/^[ \t]*//')
              
              # Cr√©e le fichier JSON final
              jq -n --arg challenge "$CHALLENGE_TEXT" --arg date "Semaine du $CHALLENGE_DATE" \
                '{challenge: $challenge, date: $date}' > challenge.json

              echo "Fichier challenge.json mis √† jour :"
              cat challenge.json

          - name: 5. Commit et Push des modifications
            uses: stefanzweifel/git-auto-commit-action@v5
            with:
              commit_message: "‚ôªÔ∏è Nouveau d√©fi : ${{ steps.get_challenge.outputs.challenge_text }}"
              file_pattern: challenge.json
              commit_user_name: D√©fi Bot ‚ôªÔ∏è
              commit_user_email: bot@github.actions.com


    --------------------------------------------------------------------
    Fichier 3 : README.md (plac√© √† la racine)
    --------------------------------------------------------------------

    # ‚ôªÔ∏è Projet : D√©fi Z√©ro D√©chet Hebdomadaire

    Ce d√©p√¥t contient un site web simple qui affiche un "D√©fi Z√©ro D√©chet" diff√©rent chaque semaine. Le d√©fi est g√©n√©r√© par une IA (Google Gemini) et mis √† jour automatiquement tous les lundis via une GitHub Action.

    ## üöÄ Comment le mettre en place

    Suivez ces √©tapes **dans l'ordre** pour que tout fonctionne.

    ### √âtape 1 : Obtenir une Cl√© API Google AI (Gemini)

    1.  Allez sur [Google AI Studio](https://aistudio.google.com/).
    2.  Connectez-vous avec votre compte Google.
    3.  Cliquez sur "Get API key" (Obtenir une cl√© API).
    4.  Cr√©ez une nouvelle cl√© API. **Copiez cette cl√© et gardez-la en s√©curit√©.**

    ### √âtape 2 : Configurer le Secret dans GitHub

    Votre GitHub Action a besoin de cette cl√© API pour fonctionner, mais elle ne doit jamais √™tre visible publiquement.

    1.  Dans votre d√©p√¥t GitHub, allez dans **Settings** (Param√®tres).
    2.  Dans le menu de gauche, allez dans **Secrets and variables** > **Actions**.
    3.  Cliquez sur le bouton **New repository secret**.
    4.  Dans le champ **Name**, entrez exactement `GEMINI_API_KEY`.
    5.  Dans le champ **Value**, collez la cl√© API que vous avez copi√©e √† l'√©tape 1.
    6.  Cliquez sur **Add secret**.

    ### √âtape 3 : Activer GitHub Pages

    C'est ce qui h√©bergera votre fichier `index.html` en tant que site web public.

    1.  Dans votre d√©p√¥t GitHub, allez dans **Settings** (Param√®tres).
    2.  Dans le menu de gauche, allez dans **Pages**.
    3.  Sous "Build and deployment", dans la section **Source**, s√©lectionnez **Deploy from a branch**.
    4.  Assurez-vous que la branche s√©lectionn√©e est votre branche principale (`main` ou `master`).
    5.  Laissez le dossier sur `/ (root)`.
    6.  Cliquez sur **Save**.

    Votre site sera disponible √† l'adresse `https://VOTRE_NOM_UTILISATEUR.github.io/NOM_DE_VOTRE_DEPOT/` apr√®s quelques minutes.

    ### √âtape 4 : Activer et Tester l'Action

    1.  Allez dans l'onglet **Actions** de votre d√©p√¥t.
    2.  Si un bandeau jaune appara√Æt, cliquez sur **I understand my workflows, go ahead and enable them**.
    3.  Dans le menu de gauche, cliquez sur **‚ôªÔ∏è Mettre √† jour le D√©fi Z√©ro D√©chet**.
    4.  Vous verrez un message "This workflow has a `workflow_dispatch` event trigger."
    5.  Cliquez sur le bouton **Run workflow** (Ex√©cuter le workflow) sur la droite.

    Patientez une minute. L'action va s'ex√©cuter, appeler l'IA, r√©cup√©rer un d√©fi, et commiter le nouveau fichier `challenge.json` dans votre d√©p√¥t.

    Rafra√Æchissez votre site web (l'URL de l'√©tape 3) et vous devriez voir le nouveau d√©fi ! √Ä partir de maintenant, l'action s'ex√©cutera toute seule chaque lundi matin.

    --></body>
</html>

